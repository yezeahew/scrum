<!-- Remove these -->
<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> -->

<!-- Keep this -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">


<div class="modal fade" id="view-task-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="view-task" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-md-down modal-dialog-scrollable">
    <div class="modal-content" style="background-color: #f2f3f5;">
      <div class="modal-header justify-content-between" style="background-color: #FF9417;">
        <h1 class="modal-title fs-5" id="view-task" style="color: #ffffff;">View Task</h1>
        <div>
          <button type="button" class="btn-delete-close" id="delete-button" aria-label="Delete">
            <i class="bi bi-trash" style="font-size: 22px;"></i>
          </button>
          <button type="button" class="btn-delete-close" data-bs-dismiss="modal" aria-label="Close">
            <i class="bi bi-x-lg" style="font-size: 22px;"></i>
          </button>
        </div>

      </div>
      <form class="modal-body" id="task-form">
        <div class="row">
          <div class="col-12 col-xl-6">
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Task Name</div>
                </div>
                <div class="row px-2">
                  <input type="text" class="form-control" style="font-size: 30px;" id="task-name-input"
                    placeholder="Name" onchange="CheckName()" disabled>
                  <div class="invalid" id="invalid-task-name" style="display: none;">! Please enter a task name.</div>
                </div>
              </div>
            </div>
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Task Type</div>
                </div>
                <div class="row">
                  <div class="col-auto px-2">
                    <input type="radio" class="btn-check" name="task-type-option" id="story" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-normal" for="story">Story</label>
                  </div>
                  <div class="col-auto px-2">
                    <input type="radio" class="btn-check" name="task-type-option" id="bug" autocomplete="off" disabled>
                    <label class="btn btn-custom-normal" for="bug">Bug</label>
                  </div>
                </div>

              </div>
            </div>
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Numerical Storypoints</div>
                  <div class="row px-3">
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="1" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="1">1</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="2" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="2">2</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="3" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="3">3</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="4" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="4">4</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="5" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="5">5</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="6" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="6">6</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="7" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="7">7</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="8" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="8">8</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="9" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="9">9</label>
                    </div>
                    <div class="col-auto p-1">
                      <input type="radio" class="btn-check" name="numerical-storypoints" id="10" autocomplete="off"
                        disabled>
                      <label class="btn btn-custom-points" for="10">10</label>
                    </div>

                  </div>
                </div>
              </div>
            </div>
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Tags</div>
                </div>
                <div class="row px-1">
                  <div class="col-auto p-1">
                    <input type="checkbox" class="btn-check" name="tags" id="front-end" autocomplete="off"
                      onchange="CheckTags()" disabled>
                    <label class="btn btn-custom-normal" for="front-end">Front End</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="checkbox" class="btn-check" name="tags" id="back-end" autocomplete="off"
                      onchange="CheckTags()" disabled>
                    <label class="btn btn-custom-normal" for="back-end">Back End</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="checkbox" class="btn-check" name="tags" id="testing" autocomplete="off"
                      onchange="CheckTags()" disabled>
                    <label class="btn btn-custom-normal" for="testing">Testing</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="checkbox" class="btn-check" name="tags" id="database" autocomplete="off"
                      onchange="CheckTags()" disabled>
                    <label class="btn btn-custom-normal" for="database">Database</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="checkbox" class="btn-check" name="tags" id="ui" autocomplete="off"
                      onchange="CheckTags()" disabled>
                    <label class="btn btn-custom-normal" for="ui">UI</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="checkbox" class="btn-check" name="tags" id="ux" autocomplete="off"
                      onchange="CheckTags()" disabled>
                    <label class="btn btn-custom-normal" for="ux">UX</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="checkbox" class="btn-check" name="tags" id="api" autocomplete="off"
                      onchange="CheckTags()" disabled>
                    <label class="btn btn-custom-normal" for="api">API</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="checkbox" class="btn-check" name="tags" id="framework" autocomplete="off"
                      onchange="CheckTags()" disabled>
                    <label class="btn btn-custom-normal" for="framework">Framework</label>
                  </div>
                  <div class="invalid" id="invalid-tags" style="display: none;">! Please select at least one tag.</div>
                </div>
              </div>
            </div>
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Task Priority</div>
                </div>
                <div class="row px-1">
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="priority-option" id="low" autocomplete="off" disabled>
                    <label class="btn btn-custom-low" for="low">Low</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="priority-option" id="medium" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-medium" for="medium">Medium</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="priority-option" id="important" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-important" for="important">Important</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="priority-option" id="urgent" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-urgent" for="urgent">Urgent</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-xl-6">
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Task Status</div>
                </div>
                <div class="row px-1">
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="task-status" id="not-started" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-normal" for="not-started">Not Started</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="task-status" id="in-progress" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-normal" for="in-progress">In Progress</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="task-status" id="completed" autocomplete="off" disabled>
                    <label class="btn btn-custom-normal" for="completed">Completed</label>
                  </div>
                </div>
              </div>
            </div>
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Current Stage</div>
                </div>
                <div class="row px-1">
                  <!-- Theres a need to prefix id with 'stage-' because one of the tags id is already called testing -->
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="current-stage" id="stage-planning" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-normal" for="stage-planning">Planning</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="current-stage" id="stage-development" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-normal" for="stage-development">Development</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="current-stage" id="stage-testing" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-normal" for="stage-testing">Testing</label>
                  </div>
                  <div class="col-auto p-1">
                    <input type="radio" class="btn-check" name="current-stage" id="stage-integration" autocomplete="off"
                      disabled>
                    <label class="btn btn-custom-normal" for="stage-integration">Integration</label>
                  </div>
                </div>
              </div>
            </div>
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Task Description</div>
                </div>
                <div class="row px-2">
                  <textarea class="form-control" id="task-description-input" style="font-size: 25px;"
                    placeholder="Describe the task" rows="3" onchange="CheckDescription()" disabled></textarea>
                  <div class="invalid" id="invalid-description" style="display: none;">! Please include a description
                    for the task.</div>
                </div>
              </div>
            </div>
            <div class="row px-3 py-1">
              <div class="container task-create">
                <div class="row">
                  <div class="input-label">Assign to</div>
                </div>
                <!-- Room for improvements, dont use multiple input modes, instead just use select -->
                <!-- Input for normal mode, shown by default -->
                <div class="input-group-lg input-normal-mode">
                  <input type="text" class="form-control" id="assign-member-input" value="Username" disabled />
                </div>
                <!-- Select for edit mode, hidden by default -->
                <div class="input-group-lg" style="display: none;">
                  <select class="form-select" id="assign-member" disabled>
                    <option selected value="">Username</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row create-button-row">
          <div class="col">
            <button type="submit" id="save-task-button" class="btn btn-create-button"
              style="visibility: hidden;">Save</button>
            <button type="button" id="edit-task-button" class="btn btn-create-button">Edit Task</button>
          </div>
        </div>
      </form>
    </div>

  </div>
</div>
<!-- Delete Confirmation Modal -->
<div class="modal fade" id="delete-confirmation-modal" tabindex="-1" aria-labelledby="delete-confirmation-label"
  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="delete-confirmation-label">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this task?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirm-delete">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- The following script contains reusable functions to remove warning messages  -->
<!-- <script src="{{ url_for('static', filename='/productBacklog/form_warnings.js') }}"></script> -->
<script src="{{ url_for('static', filename='/form_warnings.js') }}"></script>

<!-- The following script contains the script to enable task editing feature -->
<!-- The defer attribute ensures that the script runs after the HTML is parsed. -->
<script type="module" src="{{ url_for('static', filename='/edit_task.js') }}" defer></script>
<script type="module" src="{{ url_for('static', filename='/delete_task.js') }}"></script>
<script src="{{ url_for('static', filename='/edit_mode.js') }}"></script>
<!-- <script type="module" src="{{ url_for('static', filename='/productBacklog/edit_task.js') }}" defer></script>
<script type="module" src="{{ url_for('static', filename='/productBacklog/delete_task.js') }}"></script>
<script src="{{ url_for('static', filename='/productBacklog/edit_mode.js') }}"></script> -->

<script type="module">

  // need to import these to pass task as parameters
  import { setupDeleteButtonListeners } from "{{ url_for('static', filename='/delete_task.js') }}";
  import { populateTaskFields, setUpEditForm } from "{{ url_for('static', filename='/edit_task.js') }}";
  // import { setupDeleteButtonListeners } from "{{ url_for('static', filename='/productBacklog/delete_task.js') }}";
  // import { populateTaskFields, setUpEditForm } from "{{ url_for('static', filename='/productBacklog/edit_task.js') }}";

  var task = {{ fetchedTask | tojson }};

  // load task data into task form
  populateTaskFields(task);

  // add event listener to the delete button
  setupDeleteButtonListeners(task);

  // Add event listener to the edit button
  editButton.addEventListener('click', function () {
    enableEditMode();
    setUpEditForm(task.taskID, task.assigneeName);
  });
</script>